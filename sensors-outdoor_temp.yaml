# Outdoor temperature sensor configuration

# Input configuration outdoor temperatures
dallas:
  - pin: GPIO14
    id: outdoor_temperature_bus
    update_interval: 10s

# Outdoor temperature
sensor:
  - platform: dallas
    name: $node_prefix utetemperatur digital
    id: outdoor_temperature_digital
    dallas_id: outdoor_temperature_bus
    address: 0x2c0000081d200d28
    resolution: 12

# Analog temperature sensor
# NTC Beta factor calculated according to the equation below
# https://www.ametherm.com/thermistor/ntc-thermistor-beta
  - platform: ntc
    name: $node_prefix utetemperatur analog
    id: outdoor_temperature_analog
    sensor: outdoor_temperature_analog_sensor
#    calibration:
#      b_constant: 3919
#      reference_temperature: 5°C
#      reference_resistance: 5.66kOhm
    # Calibration points for UVEAB EVR-U according to documentation.
    calibration:
    # - 43.03kOhm -> -30°C
    # - 31.09kOhm -> -25°C
    # - 22.76kOhm -> -20°C
    # - 16.86kOhm -> -15°C
      - 12.63kOhm -> -10°C
    # - 9.57kOhm -> -5°C
    # - 7.32kOhm -> 0°C
      - 5.66kOhm -> 5°C
    # - 4.41kOhm -> 10°C
    # - 3.47kOhm -> 15°C
      - 2.75kOhm -> 20°C
    # - 2.20kOhm -> 25°C
  # Resistance calculation
  - platform: resistance
    name: $node_prefix utetemperatur analog sensor
    id: outdoor_temperature_analog_sensor
    icon: mdi:omega
    sensor: outdoor_temperature_analog_measure
    configuration: DOWNSTREAM
    resistor: 10kOhm
  # Voltage measurement (range 0.15-2.45V)
  - platform: adc
    id: outdoor_temperature_analog_measure
    pin: GPIO34
    update_interval: never
    attenuation: 11db

# Analog temperature sensor power source
switch:
  - platform: gpio
    pin: GPIO13
    id: outdoor_analog_sensor_power

# Analog temperature sensor update interval
interval:
  - interval: 30s
    then:
      - switch.turn_on: outdoor_analog_sensor_power
      - delay: 2s
      - component.update: outdoor_temperature_analog_measure
      - delay: 2s
      - switch.turn_off: outdoor_analog_sensor_power
